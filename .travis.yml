services:
- docker
branches:
  only:
  - master
  - devel
install:
# create environment file
- env >> .env
# building containers
- docker-compose pull
- docker-compose build
# setting up databases
- docker-compose up -d db redis
# preparing and fixing folders
- docker-compose run --no-deps --rm uwsgi sh -c 'mkdir /var/uwsgi/image/media'
- docker-compose run --no-deps --rm uwsgi sh -c 'mkdir -p /var/uwsgi/image/protected/data_source/'
- docker-compose run --no-deps --rm uwsgi sh -c 'chmod -R g+rwx media && chmod -R g+rwx protected'
- docker-compose run --no-deps --rm uwsgi sh -c 'chgrp -R www-data .'
script:
# call tests (with coverage!)
- docker-compose run --no-deps --rm uwsgi /root/wait-for-postgres.sh coverage run --source='.' -m py.test
env:
  global:
  - DEBUG=False
  - EMAIL_BACKEND=djcelery_email.backends.CeleryEmailBackend
  - CELERY_EMAIL_BACKEND=django.core.mail.backends.console.EmailBackend
  - DEFAULT_FROM_EMAIL='mail@example.com'
  - EMAIL_HOST='smtp.example.com'
  - EMAIL_HOST_USER='mail@example.com'
  - USI_MANAGER=testmanager
  - secure: Z03ZYRzoVGc96Z08si3R5TsrSddllqoFWvaLV8LkNLP3lwtSO6BAxsKbDvqid7U7Kd/BVuI8HYEi8dW5Gcyx22aztxCt9GLFY0Cbl+4o3MBO6Bmk+k5p3vc62YS97dLC8qcODy0w4gTjNl6gSZxAJxz9huFM//8xgJe4mfKUkyZDL/cA2ZRerBKb/wcC1/ym7S350nh7BX4rUyYyq55CAoy16sitLS4VjfLzyxeGU1f+wC+nC5NyCFHrOiEChQG5SJnTr+k1nt8e/UZOwgbPnXkliEBVcp8PC+m0x7023VpH0dF9tmFsxMftvqkl4KoeMAaEpgG+iXbuo6axhdseceeBGjlwPJ+4zlblxo+Tn6Eg5iFRsVQirvrbiSgcxGYNm8XxL4epf6s548R1mBOPQBCR1AeHfrc2hZEM87VjyKYylHkNLBfXQ4RdyLW7fwmJYiPgYWoHgo0mDG+ySw6tpi28idFR+hsPksIr3oii5PrRZSnygsyh0Nmv21nNKfxUddwCfwvlslx9iQMctnghr/G9EZCP/GL3/C3wPjeaxzB5JmKngCYpLfdqPwG3S2R3h94jHZpxCF4qNGqrZFrD7QNobDxEiqXAZa532D+0lg4nKJQF97QBZYItGqV1iwgA18hpLzqNThu83amaczZkPVCjT9ILgiJV21MdWTTq2I4=
  - secure: BNfMIi0sGZQV6q9Ur0zSqTv63HJsoAN1UitBzN51U98snWu4jMMv3wcMHhVJunv5Az35BPJdw9RmAmDjHCpE0AYSboCQdsNfjdgvcluKogQ3RehONnjDmWLhKRjNRhPkYEmHDlYQOVECbOLmZxVJ+oluYNR1pf+H3BhMUdFk8sER+JVf1S7XXYhXZNU4hNNWxo+b4KMrerU1mcXuBdjqRzVeVX7vj/ScoP/WpISxMDL8evP1Sml1AYeL8S5CTvn1C65QIe2y0KTD85PJwyeKXqHHv6ezG69tS160fCGwDhysSbhgF6xGhzGILYmSa3pcRcDKeBUqH+wdUo20wi2V2i2zX0csLy9o2CfMI8eU0OhGApTXKmAQPJw6EDhw70NIWtm7d34tl+Zs33EgObOvrSdyDaNmBqlByl3tJvNXCda7lmc0LgJ4ddDKvTItwAyXEdI57O4pwShyLaBSEh2XGeA+01/eevUsy2VC7fArqbCx9t7uMuVVxFQa5XCqzk0KGqHGGLsyuAvXD8qLy4Ey/TJc5YFgE8aUBowj8P98Bjz3nqTtjIuaRs+220MFfbfJdv1A3fM7L3r6+2/OMmAHezW/BiIDJ3jS03KWhHGlkm7hoTyFISvdCSOfe7cIff2SoWt5zJdM8iA3VysR1j3C2ZzsC/lDfHJZRCeDZ98E6jo=
  - secure: Rh8QyDCNwNx8eyih640oQ2zKm+39Qu1tLORadpL1/aGf97ok6OjTgHTt1dx4DIaHL2iJQmrIIBt7y6bBIpPVuyfrD49oQwqh9QPrRT/KiAy1wB1Jn9pzGbBpeJEg4/eTdKuRFuyvYciItwKgAzNfwTQcU9P9JmifhAjwGj03oe5B49K9HWNT9Uw7FZw4l1LTm2mVoAEMFdPzg6SFAX3Ow7AICX+9IQvoXyUDjC1R5ZjiQSFvjHOqUhMul3pizr+wcoUc+DwahRJVHLMG5P3NjU8otTKJc10vHdn6K/gpJlepvWT+bVlkSFIPs+OY0mx9htr+pi6TmVwn98glWkA+G1c3M4iPRWdDe3Y3JA5W/J9f8XNZshNxN62aaIFF/Fuo7VGdQdj3G/RbZm69OzYzVVc+CIGAYrz5cmmOFfR4xW4F3jN2KyMJmV8fMlQReUfIUA2ZDYyMkv4KlHfC/h6rN6x7drcV42l8yXOPOUgfqFSxjnbwqGbXMfoFn5OkQQYaUnh/zCidaaikwlJKn1oKaOaNwlblAw9j1xpv6xTUZ2g3qrm0P/9XvNtLGhJ/ongz4URaYiqkQ8EKLhaQduoTcbooah8M3wI9lCDVJX8VfDjkb6zaDOdH8dH2Yl1e04xg4n5dMXJXhqolx619udevamF5N1YqOLZOWIY87l32ltA=
  - secure: hm8m3vtI15PWQ1khCZTglqfEhZYKEEWxpkK4GZRQPex6nuwE/La+o3UfZailSz/wq2bHfVTpJg1OtDyCB0YzNuA57cutAeqGERGGtqu743TNUxYulJi8Wbh0Z09xH5IyggpbCr0WpZ80KK1bCeQ2cxttkZ6cy3QeV/Nkr1pgxQvAv48+tg7k7aA8T5I5J8sl53brjP6ADjfGnBrvFE9w5wIohmqH6vOtLBGVL6sTo5jbTnr97gxgPhwfKANdbqiyuaQnzmthL76LI6cAiR54iF89xnVBctqwe9i1nuOXs+lWel5UYIp2S1jNoGkJhMiAkndi2TfKI1JcWmJzWhm0XGvfQ8WtaSbzlV7OKAEJIJ3UWV1bRDf2+7CJ0PyAy/HnugYZ3lKax9MS2mtuVKwH1cONigrRkBvEumNUhfnXLnaGsRzcZRAeZUZTKURDbt1PN9VQA4eBX4RN1+5EWQGsDb7YyRep5uf1n8Ivf2pGZIpfdlgIz2DpW+WazLrHTG+2i0zdMv4V5NdbtV4OJYuVeY+oAnJxAACkjJzRs6ThLd/jN8LOwqiFpgflMesyO9t13bSNnkSlMfm/Kps3MDrtMxQYlCGwmClF7djNxFd8AlmlbI3Dap3xegb2w8zURvPa75b34QDx7ZC5M4OamqW7m7FUGMGjAZL9TEbaswUCi0w=
  - secure: meqZcNdIvbnj/tXVe2hBt6KboeKxVbmfoB0B1Gep9izFqjaYTbmV2jmHt8L+7IRkh4kMeztytjV0TkSA2qsP6Jq7MnrDAREnq6N7onl2xtidxYVMSGdbZUH/sQAfsCjsj0BqPM76utRmNKfOFNQhnUi3Ly47iU99PFumE1w4kXWjHQMpG3TGxgBY2fq1Hi16OQkQEjFPsu8kel62mcFi32ie8k7DWSAJwYq/bCiznZHhiIZQ33nvyeZ7dzItsf73TDlZWwcnJn1yPH/xpEbIUwPG7dogTV5ZlBEBOX74AemV/Gf/RpRV1oosnQfC41QR3uS3qT4jaoOB4PJ02Vxq+K6I5AHFNiG+qkvXj4AXI/kUpPi7xspIKn4dyVykE7aZX79EvdbDlQciMDsAFPRP+lqrjcSBEUopxKsDAQKXj1I5Am6WnbvyBFM5jeNON6dQXsPq3YP/6ZJwYo/XYEsb+6Ut9/LSjzy0q9NgsTYpSNzw1IWzEl5Iah2wlBvLCB1nnZC/U51X96xHPi6EYnvgustpzqbMPOvUsJaBETlXtPuFFzZwQPbbUPt9xUovrrh3MmfCjzkZ2VsBy9IgiYtekSsc9KleEr8hvDes+uymRXb0ucZUC/MiSjezT6BHKEJQoCbhjcqpD8F9RyPYPpU62cdDgO0XkuCArtKmP6Wqlgk=
  - secure: T/Mr0/5M1umv92UpkVyYzTLL3SKQG+YMyw1nu7pR4ZJ6GOvGWc8lx6pY5MxWywtm9mBGTczbC9E4QIcXDY093YowAntVFUBnWTFJD5N+kBGIDagA9+zMe1s/KUxQ+yxIPLSfTg0V03w+nMqmIOA52lTYgKfbd7s33osGsHHfBZQzPbVYhZaPUPJcHdRpeR/Juq96XeBJBuuk2SpVIWIVP5PQ9v0/dHM6P/TITI+AutI6daEsRaY5AISIUhqhjbXisJg2OrNfgBJfKyLSbzS1G5uHbDeQDpHL6U8b70fglE0W4iyoQ+s2IYjncg/sgpAFS9XAkWvDlWBb9RfQrbNWLQRHiIG2jyOKtyDpqqXTX5bQyKKSMrAPt4lpgEw4JPWcYGxRYIEw77niUlmrVvCpdcMOjmqGsOqFjWs49vds+O8b3i85yBtTGhdRPfRmULDigkIwIjG6chUMutduxGd7vzOc66PRMjrrU6hz5bTbOSgDMIGK8BjEijwDDSgswZDy30Enj7Ad3dezmt/gZQqpQ+OAygLf8uj6FhOuRzzARE0ucZRSyP8jcLDx4ufze/PK9/6uSfIwUvpNcPG/6r9taPQFUBJ/alKT6psytlxfAF22U4y/T3iLbtIJbo+J7f027KlqER7E+SS2rb8fcWMKefR6kb/Lt94g3nREl30Ss9c=
  - secure: saZYy9P398/+NiwdjFi6QJrDuwiGTcUCIK+a0933VZGGvmra73eh0SWhI5m2WllC6W/TtRiEDk8WZNDnjIO6a6B/rNffxrKofwxMATuU1R+y2jtWpyfpGkBo/hd4hfovSuHoR4x0C2x+fRE+j5pYVlOuc5lY8bDHASeG511Yq2EuTVi6N6asqli6cXQgDngudv6Q8vlOoOcSSV9XOzM3AbhEqvKgbDf31xjWHy5/osFyu95UD6K0pGOpXI7Ztce4NzlYekkW8201gDF7s6yyPAGBul0P7/yHRG1/0pcwdiH9Dw0QI8WiKkVd8ThcZJWgCkwkPk7oxuObF/ZVidbHm7slL4zuFyyldkF8u1tKLcqjOdbtZIeQ/ViCfCR++3WVRs+XrwPQ4uHoaB6PzF2wZz+LEHwMUpNO3axA42J7ahp/YBOs87/cC8zx9QOwscBnT9M8tULClPYcVFmaiH+ovlcykZlBhBbSrODKCy29Pr4WCJj2FggLKxJlAM1pq2t1Ch3oyi2cHyBLcNRMH6P3KtYsmCUDgOoyF+MJhHLZ4ALR/ndnufJc9tRZHrPQy262OVoSoNlurSxs+GTFLIXtYlbPpjpdGMutjAmPrGNFkC0Rpdwwx3lcmsdaep3dh+dM/n+wCAsEJFBke6G+UghoLY1zwzrVcrx8RHywEXQZ/8Y=
  - secure: vufPWMbzHRtDoSSPBbMZrv18tVd/aVxlqTjMbnxcAmKTJ3O1hX1Q1HMDeqZ4uQ2SqdzG2GkSLoXvDTe1vcnQlx4Dcrk+wMR16Ia2G0dFeGMhUOLOfMBwtqcTrEfq/2DqWh7Fkb+lMikgYbcvP3eBEWaaa2UF5iZ0nXBkW/4cgvU7wwAzKEfeyhY6S9C4aeqO9MReO1Bi6nc2YhrGzNrPoOO+31Izo5esqtvMkWCoL5PVOuTax3lqHpK8kSPJyq7dFIaWfUrKELlE0R/coZ8CKHX/PyjPAZEqauqvySZq7Q9frgozjcM/EOsIrQNuJAd8Ls0oq+kV0IxpTgffH0vmaoEZDAhBAUsp84ZAfLZ0ZDcpk47phAcOCh3JwHOGtI+hODG/u84vq4O2baPbct9I59igaVuzCeHmoHUEHA7EwbAf1aWlp6Fq/3RP//cejP+dFONbBgEkvPsvFlkAbg12VGAdfMSbLsOsEXsLJE99jDk3n1LbJMMwkjU2mspwVEmgq7NyvnU3afam+l1ad+3/SCh5abE030xoUYNb8UbGZyO2jEu04KV7PubfNkf29/18DZZ9wnOl4+cR0wimRrF/C6raiyVak8AGxaNNNPudRQViYVyBALPpLxtfvqhaPh/rOER1V3cA3gcGNU0Ox2vqIlM69INEIER+ib+XIfFLDzg=
